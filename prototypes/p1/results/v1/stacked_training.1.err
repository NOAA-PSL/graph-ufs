(graphufs-cpu2) [azure_pw v1]$ cat stacked_training.1.err
/contrib2/Tim.Smith/graph-ufs/graphufs/training.py:59: UserWarning: Import failed for either mpi4py or mpi4jax.
  warnings.warn("Import failed for either mpi4py or mpi4jax.")
/contrib2/Tim.Smith/graph-ufs/graphufs/stacked_training.py:50: UserWarning: Import failed for either mpi4py or mpi4jax.
  warnings.warn("Import failed for either mpi4py or mpi4jax.")
2024-06-12 19:14:48.122286: E external/xla/xla/service/slow_operation_alarm.cc:65] Constant folding an instruction is taking > 1s:

  %compare.5788 = pred[221184,1]{1,0} compare(s32[221184,1]{1,0} %constant.857, s32[221184,1]{1,0} %broadcast.5787), direction=LE, metadata={op_name="jit(optim_step)/jit(main)/transpose(jvp(mesh2grid_gnn))/_process/mesh2grid_gnn/_process_step/mesh2grid_gnn/le" source_file="/contrib2/Tim.Smith/graph-ufs/graphcast/graphcast/deep_typed_graph_net.py" source_line=226}

This isn't necessarily a bug; constant-folding is inherently a trade-off between compilation time and speed at runtime. XLA has some guards that attempt to keep constant folding from taking too long, but fundamentally you'll always be able to come up with an input program that takes a long time.

If you'd like to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
2024-06-12 19:14:48.171142: E external/xla/xla/service/slow_operation_alarm.cc:133] The operation took 1.049049393s
Constant folding an instruction is taking > 1s:

  %compare.5788 = pred[221184,1]{1,0} compare(s32[221184,1]{1,0} %constant.857, s32[221184,1]{1,0} %broadcast.5787), direction=LE, metadata={op_name="jit(optim_step)/jit(main)/transpose(jvp(mesh2grid_gnn))/_process/mesh2grid_gnn/_process_step/mesh2grid_gnn/le" source_file="/contrib2/Tim.Smith/graph-ufs/graphcast/graphcast/deep_typed_graph_net.py" source_line=226}

This isn't necessarily a bug; constant-folding is inherently a trade-off between compilation time and speed at runtime. XLA has some guards that attempt to keep constant folding from taking too long, but fundamentally you'll always be able to come up with an input program that takes a long time.

If you'd like to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
loss = 2.89623, qsize = 0, LR = 9.99e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:45:19<00:00,  1.33s/it]
validation loss = 3.12402: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [07:58<00:00,  1.47s/it]
loss = 2.37859, qsize = 0, LR = 9.97e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:46:00<00:00,  1.34s/it]
validation loss = 2.43951: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [07:10<00:00,  1.32s/it]
loss = 2.06853, qsize = 0, LR = 9.92e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:13<00:00,  1.29s/it]
validation loss = 2.27864: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:54<00:00,  1.28s/it]
loss = 2.08532, qsize = 0, LR = 9.86e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:46<00:00,  1.29s/it]
validation loss = 2.23238: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:54<00:00,  1.28s/it]
loss = 1.90873, qsize = 0, LR = 9.77e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:52<00:00,  1.29s/it]
validation loss = 2.12818: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:52<00:00,  1.27s/it]
loss = 1.98080, qsize = 0, LR = 9.67e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:04<00:00,  1.29s/it]
validation loss = 2.09801: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:55<00:00,  1.28s/it]
loss = 1.92525, qsize = 0, LR = 9.55e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:46<00:00,  1.29s/it]
validation loss = 2.07365: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:55<00:00,  1.28s/it]
loss = 2.01072, qsize = 0, LR = 9.41e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:25<00:00,  1.29s/it]
validation loss = 2.04889: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:52<00:00,  1.27s/it]
loss = 1.93831, qsize = 0, LR = 9.25e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:17<00:00,  1.28s/it]
validation loss = 2.02947: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:54<00:00,  1.27s/it]
loss = 1.85564, qsize = 0, LR = 9.08e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:08<00:00,  1.29s/it]
validation loss = 1.99151: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:58<00:00,  1.29s/it]
loss = 1.84688, qsize = 0, LR = 8.89e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:10<00:00,  1.29s/it]
validation loss = 2.00274: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:57<00:00,  1.29s/it]
loss = 1.78967, qsize = 0, LR = 8.68e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:52<00:00,  1.30s/it]
validation loss = 1.93327: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:53<00:00,  1.27s/it]
loss = 1.82058, qsize = 0, LR = 8.46e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:43:16<00:00,  1.31s/it]
validation loss = 1.97786: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.82495, qsize = 0, LR = 8.22e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:21<00:00,  1.29s/it]
validation loss = 1.96374: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:57<00:00,  1.28s/it]
loss = 1.79028, qsize = 0, LR = 7.98e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:39<00:00,  1.30s/it]
validation loss = 1.96015: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:54<00:00,  1.28s/it]
loss = 1.87161, qsize = 0, LR = 7.72e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:40:54<00:00,  1.28s/it]
validation loss = 1.92666: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:52<00:00,  1.27s/it]
loss = 1.90168, qsize = 0, LR = 7.45e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:29<00:00,  1.28s/it]
validation loss = 1.99489: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:53<00:00,  1.27s/it]
loss = 1.78990, qsize = 0, LR = 7.17e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:02<00:00,  1.28s/it]
validation loss = 1.86109: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.74041, qsize = 0, LR = 6.88e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:40:59<00:00,  1.28s/it]
validation loss = 1.85857: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:55<00:00,  1.28s/it]
loss = 1.79189, qsize = 0, LR = 6.58e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:34<00:00,  1.28s/it]
validation loss = 1.92916: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:55<00:00,  1.28s/it]
loss = 1.72313, qsize = 0, LR = 6.28e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:40:39<00:00,  1.27s/it]
validation loss = 1.84124: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:52<00:00,  1.27s/it]
loss = 1.70938, qsize = 0, LR = 5.97e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:25<00:00,  1.28s/it]
validation loss = 1.83934: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:54<00:00,  1.28s/it]
loss = 1.67526, qsize = 0, LR = 5.66e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:30<00:00,  1.28s/it]
validation loss = 1.82802: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:54<00:00,  1.28s/it]
loss = 1.65920, qsize = 0, LR = 5.35e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:01<00:00,  1.28s/it]
validation loss = 1.82666: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:53<00:00,  1.27s/it]
loss = 1.68725, qsize = 0, LR = 5.03e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:24<00:00,  1.29s/it]
validation loss = 1.80149: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:53<00:00,  1.27s/it]
loss = 1.61307, qsize = 0, LR = 4.72e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:17<00:00,  1.28s/it]
validation loss = 1.81426: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:54<00:00,  1.28s/it]
loss = 1.64083, qsize = 0, LR = 4.40e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:41<00:00,  1.29s/it]
validation loss = 1.76448: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:58<00:00,  1.29s/it]
loss = 1.63758, qsize = 0, LR = 4.09e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:35<00:00,  1.28s/it]
validation loss = 1.75871: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.69677, qsize = 0, LR = 3.78e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:12<00:00,  1.28s/it]
validation loss = 1.75419: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:58<00:00,  1.29s/it]
loss = 1.62267, qsize = 0, LR = 3.48e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:22<00:00,  1.28s/it]
validation loss = 1.72799: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:52<00:00,  1.27s/it]
loss = 1.63205, qsize = 0, LR = 3.18e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:11<00:00,  1.28s/it]
validation loss = 1.71918: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:50<00:00,  1.26s/it]
loss = 1.63788, qsize = 0, LR = 2.89e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:40:57<00:00,  1.28s/it]
validation loss = 1.69312: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:52<00:00,  1.27s/it]
loss = 1.56409, qsize = 0, LR = 2.61e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:03<00:00,  1.28s/it]
validation loss = 1.69162: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [07:08<00:00,  1.32s/it]
loss = 1.58374, qsize = 0, LR = 2.34e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:27<00:00,  1.28s/it]
validation loss = 1.69014: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.53613, qsize = 0, LR = 2.08e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:43:04<00:00,  1.30s/it]
validation loss = 1.66796: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [07:21<00:00,  1.36s/it]
loss = 1.52807, qsize = 0, LR = 1.83e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:44<00:00,  1.30s/it]
validation loss = 1.65281: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:55<00:00,  1.28s/it]
loss = 1.51214, qsize = 0, LR = 1.59e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:25<00:00,  1.29s/it]
validation loss = 1.65238: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:59<00:00,  1.29s/it]
loss = 1.46672, qsize = 0, LR = 1.37e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:48<00:00,  1.29s/it]
validation loss = 1.62050: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.49529, qsize = 0, LR = 1.16e-04: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:52<00:00,  1.29s/it]
validation loss = 1.61050: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.48180, qsize = 0, LR = 9.63e-05: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:17<00:00,  1.29s/it]
validation loss = 1.60004: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.45973, qsize = 0, LR = 7.85e-05: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:51<00:00,  1.29s/it]
validation loss = 1.58896: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.41218, qsize = 0, LR = 6.24e-05: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:38<00:00,  1.28s/it]
validation loss = 1.57161: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:54<00:00,  1.28s/it]
loss = 1.43697, qsize = 0, LR = 4.80e-05: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:48:12<00:00,  1.37s/it]
validation loss = 1.55682: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.40372, qsize = 0, LR = 3.54e-05: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:09<00:00,  1.29s/it]
validation loss = 1.54742: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:56<00:00,  1.28s/it]
loss = 1.39682, qsize = 0, LR = 2.47e-05: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:05<00:00,  1.29s/it]
validation loss = 1.53658: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:57<00:00,  1.29s/it]
loss = 1.44950, qsize = 0, LR = 1.58e-05: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:41:51<00:00,  1.29s/it]
validation loss = 1.53041: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:59<00:00,  1.29s/it]
loss = 1.39428, qsize = 0, LR = 8.93e-06: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:20<00:00,  1.29s/it]
validation loss = 1.52271: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:58<00:00,  1.29s/it]
loss = 1.39030, qsize = 0, LR = 3.98e-06: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:50<00:00,  1.30s/it]
validation loss = 1.51937: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [07:13<00:00,  1.33s/it]
loss = 1.36763, qsize = 0, LR = 9.95e-07: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:28<00:00,  1.30s/it]
validation loss = 1.51776: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:57<00:00,  1.28s/it]
loss = 1.37260, qsize = 0, LR = 0.00e+00: 100%|███████████████████████████████████████████████████████| 4748/4748 [1:42:10<00:00,  1.29s/it]
validation loss = 1.51707: 100%|██████████████████████████████████████████████████████████████████████████| 325/325 [06:59<00:00,  1.29s/it]
slurmstepd: error: *** JOB 1 ON timsmith-p1rocky-00017-3-0008 CANCELLED AT 2024-06-17T15:24:13 ***

